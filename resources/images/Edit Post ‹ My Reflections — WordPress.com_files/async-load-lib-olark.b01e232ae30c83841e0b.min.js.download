webpackJsonp(["async-load-lib-olark"],{"./client/lib/olark-events/index.js":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a("./node_modules/debug/browser.js"),o=n(i),r=a("./client/lib/mixins/emitter/index.js"),l=n(r),s=["api.box.onShow","api.box.onHide","api.box.onExpand","api.box.onShrink","api.chat.onReady","api.chat.onOperatorsAvailable","api.chat.onOperatorsAway","api.chat.onBeginConversation","api.chat.onMessageToOperator","api.chat.onMessageToVisitor","api.chat.onCommandFromOperator","api.chat.onOfflineMessageToOperator"],c=(0,o.default)("calypso:olark:events"),u={},d=!1,f=!1,p={initialize:function(){var e=this;return d?void c("Already initalized"):(d=!0,s.forEach(function(t){return e.addOlarkEventListener(t)}),void c("Initalized"))},addOlarkEventListener:function(e){c("Adding olark event listener: %s",e),u[e]||(u[e]=!0)},olarkEventListener:function(e){c("Olark event: %s",e);for(var t=arguments.length,a=Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];this.emit.apply(this,[e].concat(a))}};(0,l.default)(p),p.once("api.chat.onReady",function(){f=!0}),p.on("newListener",function(e,t){f&&"api.chat.onReady"===e&&t()}),t.default=p,e.exports=t.default},"./client/lib/olark-store/actions.js":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a("./client/dispatcher/index.js"),o=n(i),r=a("./client/lib/olark-store/constants.js"),l={setUserEligibility:function(e){o.default.handleServerAction({isUserEligible:e,type:r.action.OLARK_USER_ELIGIBILITY})},setLocale:function(e){o.default.handleServerAction({locale:e,type:r.action.OLARK_LOCALE})},setReady:function(){o.default.handleServerAction({type:r.action.OLARK_READY})},setOperatorsAvailable:function(){o.default.handleServerAction({type:r.action.OLARK_OPERATORS_AVAILABLE})},setOperatorsAway:function(){o.default.handleServerAction({type:r.action.OLARK_OPERATORS_AWAY})},setClosed:function(e){o.default.handleServerAction({isSupportClosed:e,type:r.action.OLARK_SET_CLOSED})},setExpanded:function(e){o.default.handleServerAction({isOlarkExpanded:e,type:r.action.OLARK_SET_EXPANDED})},updateDetails:function(){},sendNotificationToVisitor:function(){},sendNotificationToOperator:function(){},expandBox:function(){},shrinkBox:function(){},hideBox:function(){},focusBox:function(){}};t.default=l,e.exports=t.default},"./client/lib/olark-store/constants.js":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.action=void 0;var i=a("./node_modules/key-mirror/index.js"),o=n(i);t.action=(0,o.default)({OLARK_READY:null,OLARK_OPERATORS_AWAY:null,OLARK_OPERATORS_AVAILABLE:null,OLARK_DETAILS:null,OLARK_LOCALE:null,OLARK_USER_ELIGIBILITY:null,OLARK_SET_CLOSED:null,OLARK_SET_EXPANDED:null})},"./client/lib/olark-store/index.js":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a("./node_modules/babel-runtime/core-js/object/assign.js"),o=n(i),r=a("./client/lib/store/index.js"),l=a("./client/lib/olark-store/constants.js"),s={isOperatorAvailable:!1,isOlarkReady:!1,isUserEligible:!1,isOlarkExpanded:!1,isSupportClosed:!1,locale:"en",details:{}},c=(0,r.createReducerStore)(function(e,t){var a=void 0,n=t.action;switch(n.type){case l.action.OLARK_USER_ELIGIBILITY:a={isUserEligible:n.isUserEligible};break;case l.action.OLARK_LOCALE:a={locale:n.locale};break;case l.action.OLARK_READY:a={isOlarkReady:!0};break;case l.action.OLARK_OPERATORS_AWAY:a={isOperatorAvailable:!1};break;case l.action.OLARK_OPERATORS_AVAILABLE:a={isOperatorAvailable:!0};break;case l.action.OLARK_SET_EXPANDED:a={isOlarkExpanded:n.isOlarkExpanded};break;case l.action.OLARK_DETAILS:a={details:n.details};break;case l.action.OLARK_SET_CLOSED:a={isSupportClosed:n.isSupportClosed}}return a?(0,o.default)({},e,a):e},s);t.default=c,e.exports=t.default},"./client/lib/olark/index.js":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=a("./node_modules/babel-runtime/core-js/promise.js"),o=n(i),r=a("./node_modules/debug/browser.js"),l=n(r),s=a("./client/config/index.js"),c=n(s),u=a("./node_modules/i18n-calypso/index.js"),d=n(u),f=a("./client/lib/wp/browser.js"),p=n(f),A=a("./client/lib/mixins/emitter/index.js"),O=n(A),_=a("./client/lib/user/index.js"),b=n(_),h=a("./client/notices/index.js"),E=n(h),v=a("./client/lib/olark-events/index.js"),y=n(v),g=a("./client/lib/olark-store/index.js"),k=n(g),m=a("./client/lib/olark-store/actions.js"),R=n(m),L=a("./client/state/ui/olark/actions.js"),x=(0,l.default)("calypso:olark"),S=(0,b.default)(),T=p.default.undocumented();a("./client/lib/olark-store/index.js");var C={apiId:1,eligibilityKey:"SupportChat",operatorsAvailableKey:"OlarkOperatorsAvailable",conversationStarted:!1,operatorAvailable:!1,userType:"Unknown",initialize:function(e){var t=this;x("Initializing Olark Live Chat"),this.getOlarkConfiguration().then(function(a){return t.configureOlark(a,e)}).catch(function(e){return t.handleError(e)})},handleError:function(e){e&&e.message&&"authorization_required"!==e.error&&E.default.error(e.message)},getOlarkConfiguration:function(){return new o.default(function(e,t){x("Using rest api to get olark configuration");var a=(0,c.default)("client_slug");T.getOlarkConfiguration(a,function(a,n){return a?void t(a):void e(n)})})},configureOlark:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments[1],n=S.get(),i=["api.chat.onReady","api.chat.onOperatorsAway","api.chat.onOperatorsAvailable","api.chat.onBeginConversation","api.chat.onMessageToVisitor","api.chat.onMessageToOperator","api.chat.onCommandFromOperator"],o=["api.box.onShow","api.box.onExpand","api.box.onHide","api.box.onShrink","api.chat.onMessageToVisitor"],r=["api.chat.onReady","api.chat.onBeginConversation","api.chat.onMessageToVisitor","api.chat.onMessageToOperator","api.chat.onCommandFromOperator","api.chat.onOfflineMessageToOperator"];y.default.initialize(),y.default.once("api.chat.onReady",R.default.setReady),y.default.once("api.chat.onReady",function(){return a((0,L.olarkReady)())}),y.default.on("api.chat.onOperatorsAway",R.default.setOperatorsAway),y.default.on("api.chat.onOperatorsAway",function(){return a((0,L.operatorsAway)())}),y.default.on("api.chat.onOperatorsAvailable",R.default.setOperatorsAvailable),y.default.on("api.chat.onOperatorsAvailable",function(){return a((0,L.operatorsAvailable)())}),o.forEach(this.hookExpansionEventToStoreSync.bind(this)),i.forEach(function(e){return y.default.on(e,R.default.updateDetails)}),r.forEach(function(t){return y.default.on(t,function(){setTimeout(function(){return e.updateOlarkFormatting(n.display_name,n.avatar_URL)},0)})}),x("Olark code loaded, beginning configuration"),y.default.on("api.chat.onCommandFromOperator",function(e){"end"===e.command.name&&R.default.sendNotificationToVisitor(d.default.translate("Your live chat has ended. We'll send a transcript to %(email)s.",{args:{email:n.email}}))}),this.setOlarkOptions(n,t),a((0,L.setChatAvailability)(t.availability))},updateOlarkGroupAndEligibility:function(){var e=this;this.getOlarkConfiguration().then(function(e){var t="undefined"==typeof e.isUserEligible||e.isUserEligible;R.default.setUserEligibility(t)}).catch(function(t){return e.handleError(t)})},syncStoreWithExpandedState:function(){var e=!!document.querySelector(".olrk-state-expanded");e!==k.default.get().isOlarkExpanded&&R.default.setExpanded(e)},hookExpansionEventToStoreSync:function(e){y.default.on(e,this.syncStoreWithExpandedState)},setOlarkOptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.group||(0,c.default)("olark").business_group_id,n="undefined"==typeof t.isUserEligible||t.isUserEligible,i=t.nickname||e.username+" | "+this.userType;x("Nickname: "+i),x("Group: "+a),R.default.setUserEligibility(n),R.default.setClosed(t.isClosed),t.locale&&R.default.setLocale(t.locale)},updateOlarkFormatting:function(e,t){var a,n,i,o,r,l,s,c,u,f,p,A=document.querySelectorAll(".hbl_pal_local_fg, .hbl_pal_remote_fg:not(.habla_conversation_notification_nickname)"),O=document.querySelectorAll(".olrk_avatar"),_={},b="//gravatar.com/avatar?s=32&d=identicon&r=PG",h=d.default.translate("staff");for(r=0;r<O.length;r++)l=O.item(r),s=l.parentElement.querySelector(".hbl_pal_remote_fg"),s&&(_[s.originalTextContent||s.textContent]=l.getAttribute("src"));for(u=0;u<A.length;u++)f=A.item(u),a=f.className.replace(/.*(habla_conversation_person\d+).*/,"$1"),p=!!f.className.match(/hbl_pal_local_fg/),c=f.textContent,n!==a?(p?f.textContent=e:f.querySelector(".staff-label")||(f.originalTextContent=f.textContent,f.textContent=f.textContent.replace(":",""),o=document.createElement("span"),o.setAttribute("class","staff-label"),o.appendChild(document.createTextNode(h)),f.appendChild(o)),f.querySelector(".gravatar")||(i=document.createElement("img"),i.setAttribute("class","gravatar"),p?i.setAttribute("src",t):i.setAttribute("src",_[c]||b),f.insertBefore(i,f.firstChild)),n=a):f.parentElement.removeChild(f)}};(0,O.default)(C),e.exports=C},"./client/state/ui/olark/actions.js":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(){return{type:f.OLARK_TIMEOUT}}function o(){return{type:f.OLARK_READY}}function r(){return{type:f.OLARK_OPERATORS_AVAILABLE}}function l(){return{type:f.OLARK_OPERATORS_AWAY}}function s(e){return{type:f.OLARK_SET_AVAILABILITY,availability:e}}function c(){return function(e){return e({type:f.OLARK_REQUEST}),new d.default(function(t){e(i()),t()})}}Object.defineProperty(t,"__esModule",{value:!0});var u=a("./node_modules/babel-runtime/core-js/promise.js"),d=n(u);t.olarkTimeout=i,t.olarkReady=o,t.operatorsAvailable=r,t.operatorsAway=l,t.setChatAvailability=s,t.requestOlark=c;var f=a("./client/state/action-types.js")}});